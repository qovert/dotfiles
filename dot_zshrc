# If you come from bash you might have to change your $PATH.
export PATH=$HOME/.local/share/$USER/nvim-bin:$HOME/.local/bin:$HOME/bin:/usr/local/bin:$PATH

# Set path env between multiple systems
# Helper function to safely add to PATH
add_to_path() {
    if [[ -d "$1" && ":$PATH:" != *":$1:"* ]]; then
        export PATH="$1:$PATH"
    fi
}

# Common paths for all systems
add_to_path "$HOME/bin"
add_to_path "$HOME/.local/bin"

# OS-specific paths
case "$(uname -s)" in
    Darwin*)
        # macOS Homebrew paths
        add_to_path "/opt/homebrew/bin"
        add_to_path "/opt/homebrew/sbin"
        add_to_path "/usr/local/bin"

        # macOS app paths
        add_to_path "/Applications/Visual Studio Code.app/Contents/Resources/app/bin"
        add_to_path "/Applications/Docker.app/Contents/Resources/bin"

        # macOS HOME paths
        "$HOME/Library/Python/3.9/bin"
        "$HOME/bin"
        ;;
    Linux*)
        # System addition
        add_to_path "/usr/local/bin"
        
        # Linux Homebrew (if installed)
        add_to_path "/home/linuxbrew/.linuxbrew/bin"
        add_to_path "/home/linuxbrew/.linuxbrew/sbin"

        # Flatpak exports
        add_to_path "/var/lib/flatpak/exports/bin"
        add_to_path "$HOME/.local/share/flatpak/exports/bin"

        # Local stuff
        add_to_path "$HOME/.local/bin"
        add_to_path "$HOME/bin"
        ;;
esac

# Powershell slow.
export POWERSHELL_TELEMETRY_OPTOUT=1

# Python stuff
export WORKON_HOME=$HOME/.virtualenvs
if [[ -e /home/$USER/.local/bin/virtualenvwrapper.sh ]]; then
  source /home/$USER/.local/bin/virtualenvwrapper.sh
elif [[ -e /usr/local/bin/virtualenvwrapper.sh ]]; then
  source /usr/local/bin/virtualenvwrapper.sh
fi

# Terraform creds
export ARM_SUBSCRIPTION_ID="op://Infra/Azure CLI TF env/ARM_SUBSCRIPTION_id"
export ARM_TENANT_ID="op://Infra/Azure CLI TF env/ARM_TENANT_ID"
export ARM_CLIENT_ID="op://Infra/Azure CLI TF env/ARM_CLIENT_ID"
export ARM_CLIENT_SECRET="op://Infra/Azure CLI TF env/ARM_CLIENT_SECRET"

HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt appendhistory

zstyle ':completion:*' matcher-list '' 'm:{a-zA-Z}={A-Za-z}' 'r:|=*' 'l:|=* r:|=*'
autoload -Uz compinit && compinit
compinit

plugins=(git vscode 1password docker)

case `uname` in
  Darwin)
    eval "$(oh-my-posh init zsh --config $(brew --prefix oh-my-posh)/themes/kali.omp.json)"
    ;;
  Linux)
    eval "$(oh-my-posh init zsh --config ~/.config/omp_themes/kali.omp.json)"
    ;;
esac

if command -v op &>/dev/null; then
  eval "$(op completion zsh)"; compdef _op op
  if [[ -f ~/.config/op/plugins.sh ]]; then
    source ~/.config/op/plugins.sh
  fi
fi

# Tilix VTE Config
if [ $TILIX_ID ] || [ $VTE_VERSION ]; then
        source /etc/profile.d/vte*.sh
fi

# Preferred editor for local and remote sessions
# if [[ -n $SSH_CONNECTION ]]; then
#   export EDITOR='vim'
# else
#   export EDITOR='mvim'
# fi

# Set vim key repeat in VSCode for macOS
if [[ "$OSTYPE" == "darwin"* ]]; then
  if defaults read com.microsoft.VSCode ApplePressAndHoldEnabled; then
  defaults write com.microsoft.VSCode ApplePressAndHoldEnabled -bool false
  fi
fi

# custom functions
getrez() {
	find $1 -type f -name "*.jpg" -exec identify -format "%f %[fx:w]x%[fx:h]\n" {} \;
}

# Workaround for ghostty not seeming to know how to be xterm compatable
if [[ "$TERM_PROGRAM" == "ghostty" ]]; then
    export TERM=xterm-256color
fi

# aliases
if command -v podman > /dev/null
then
  alias docker=podman
fi
alias pwgen="tr -dc A-Za-z-0-9 </dev/urandom |head -c 15 ; echo ''"
alias dy="dig +short @dns.toys"
alias python="python3"

# alias zshconfig="mate ~/.zshrc"
# alias ohmyzsh="mate ~/.oh-my-zsh"
